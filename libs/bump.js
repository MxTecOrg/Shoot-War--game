class Bump{constructor(a=PIXI){if(void 0===a)throw new Error("Please assign a rendering engine in the constructor before using bump.js");this.renderer="pixi"}addCollisionProperties(a){"pixi"===this.renderer&&(void 0===a.gx&&Object.defineProperty(a,"gx",{get:()=>a.getGlobalPosition().x,enumerable:!0,configurable:!0}),void 0===a.gy&&Object.defineProperty(a,"gy",{get:()=>a.getGlobalPosition().y,enumerable:!0,configurable:!0}),void 0===a.centerX&&Object.defineProperty(a,"centerX",{get:()=>a.x+a.width/2,enumerable:!0,configurable:!0}),void 0===a.centerY&&Object.defineProperty(a,"centerY",{get:()=>a.y+a.height/2,enumerable:!0,configurable:!0}),void 0===a.halfWidth&&Object.defineProperty(a,"halfWidth",{get:()=>a.width/2,enumerable:!0,configurable:!0}),void 0===a.halfHeight&&Object.defineProperty(a,"halfHeight",{get:()=>a.height/2,enumerable:!0,configurable:!0}),void 0===a.xAnchorOffset&&Object.defineProperty(a,"xAnchorOffset",{get:()=>void 0!==a.anchor?a.width*a.anchor.x:0,enumerable:!0,configurable:!0}),void 0===a.yAnchorOffset&&Object.defineProperty(a,"yAnchorOffset",{get:()=>void 0!==a.anchor?a.height*a.anchor.y:0,enumerable:!0,configurable:!0}),a.circular&& void 0===a.radius&&Object.defineProperty(a,"radius",{get:()=>a.width/2,enumerable:!0,configurable:!0})),a._bumpPropertiesAdded=!0}hitTestPoint(b,a){a._bumpPropertiesAdded||this.addCollisionProperties(a);let d,e,f,g,h,c;if("rectangle"==(d=a.radius?"circle":"rectangle")&&(e=a.x-a.xAnchorOffset,f=a.x+a.width-a.xAnchorOffset,g=a.y-a.yAnchorOffset,h=a.y+a.height-a.yAnchorOffset,c=b.x>e&&b.x<f&&b.y>g&&b.y<h),"circle"===d){let i=b.x-a.x-a.width/2+a.xAnchorOffset,j=b.y-a.y-a.height/2+a.yAnchorOffset;c=Math.sqrt(i*i+j*j)<a.radius}return c}hitTestCircle(a,b,e=!1){a._bumpPropertiesAdded||this.addCollisionProperties(a),b._bumpPropertiesAdded||this.addCollisionProperties(b);let c,d,f;return e?(c=b.gx+b.width/2-b.xAnchorOffset-(a.gx+a.width/2-a.xAnchorOffset),d=b.gy+b.width/2-b.yAnchorOffset-(a.gy+a.width/2-a.yAnchorOffset)):(c=b.x+b.width/2-b.xAnchorOffset-(a.x+a.width/2-a.xAnchorOffset),d=b.y+b.width/2-b.yAnchorOffset-(a.y+a.width/2-a.yAnchorOffset)),Math.sqrt(c*c+d*d)<a.radius+b.radius}circleCollision(a,b,l=!1,m=!1){a._bumpPropertiesAdded||this.addCollisionProperties(a),b._bumpPropertiesAdded||this.addCollisionProperties(b);let e,h,f,c,d,i,j,g={},k=!1;return m?(c=b.gx+b.width/2-b.xAnchorOffset-(a.gx+a.width/2-a.xAnchorOffset),d=b.gy+b.width/2-b.yAnchorOffset-(a.gy+a.width/2-a.yAnchorOffset)):(c=b.x+b.width/2-b.xAnchorOffset-(a.x+a.width/2-a.xAnchorOffset),d=b.y+b.width/2-b.yAnchorOffset-(a.y+a.width/2-a.yAnchorOffset)),(e=Math.sqrt(c*c+d*d))<(h=a.radius+b.radius)&&(k=!0,f=h-e,f+=.3,i=c/e,j=d/e,a.x-=f*i,a.y-=f*j,l&&(g.x=d,g.y=-c,this.bounceOffSurface(a,g))),k}movingCircleCollision(b,c,q=!1){b._bumpPropertiesAdded||this.addCollisionProperties(b),c._bumpPropertiesAdded||this.addCollisionProperties(c);let i,d,j,k,a={},e={},f={},g={},h={},l=!1;if(b.mass=b.mass||1,c.mass=c.mass||1,q?(a.vx=c.gx+c.radius-c.xAnchorOffset-(b.gx+b.radius-b.xAnchorOffset),a.vy=c.gy+c.radius-c.yAnchorOffset-(b.gy+b.radius-b.yAnchorOffset)):(a.vx=c.x+c.radius-c.xAnchorOffset-(b.x+b.radius-b.xAnchorOffset),a.vy=c.y+c.radius-c.yAnchorOffset-(b.y+b.radius-b.yAnchorOffset)),a.magnitude=Math.sqrt(a.vx*a.vx+a.vy*a.vy),i=b.radius+c.radius,a.magnitude<i){l=!0,d=i-a.magnitude,d+=.3,a.dx=a.vx/a.magnitude,a.dy=a.vy/a.magnitude,a.vxHalf=Math.abs(a.dx*d/2),a.vyHalf=Math.abs(a.dy*d/2),j=b.x>c.x?1:-1,k=b.y>c.y?1:-1,b.x=b.x+a.vxHalf*j,b.y=b.y+a.vyHalf*k,c.x=c.x+ -(a.vxHalf*j),c.y=c.y+ -(a.vyHalf*k),a.lx=a.vy,a.ly=-a.vx;let m=b.vx*a.dx+b.vy*a.dy;e.x=m*a.dx,e.y=m*a.dy;let n=b.vx*(a.lx/a.magnitude)+b.vy*(a.ly/a.magnitude);f.x=n*(a.lx/a.magnitude),f.y=n*(a.ly/a.magnitude);let o=c.vx*a.dx+c.vy*a.dy;g.x=o*a.dx,g.y=o*a.dy;let p=c.vx*(a.lx/a.magnitude)+c.vy*(a.ly/a.magnitude);h.x=p*(a.lx/a.magnitude),h.y=p*(a.ly/a.magnitude),b.bounce={},b.bounce.x=f.x+g.x,b.bounce.y=f.y+g.y,c.bounce={},c.bounce.x=e.x+h.x,c.bounce.y=e.y+h.y,b.vx=b.bounce.x/b.mass,b.vy=b.bounce.y/b.mass,c.vx=c.bounce.x/c.mass,c.vy=c.bounce.y/c.mass}return l}multipleCircleCollision(a,d=!1){for(let b=0;b<a.length;b++){var e=a[b];for(let c=b+1;c<a.length;c++){let f=a[c];this.movingCircleCollision(e,f,d)}}}rectangleCollision(a,b,j=!1,k=!0){a._bumpPropertiesAdded||this.addCollisionProperties(a),b._bumpPropertiesAdded||this.addCollisionProperties(b);let c,h,i,f,g,d,e;return k?(d=a.gx+Math.abs(a.halfWidth)-a.xAnchorOffset-(b.gx+Math.abs(b.halfWidth)-b.xAnchorOffset),e=a.gy+Math.abs(a.halfHeight)-a.yAnchorOffset-(b.gy+Math.abs(b.halfHeight)-b.yAnchorOffset)):(d=a.x+Math.abs(a.halfWidth)-a.xAnchorOffset-(b.x+Math.abs(b.halfWidth)-b.xAnchorOffset),e=a.y+Math.abs(a.halfHeight)-a.yAnchorOffset-(b.y+Math.abs(b.halfHeight)-b.yAnchorOffset)),h=Math.abs(a.halfWidth)+Math.abs(b.halfWidth),i=Math.abs(a.halfHeight)+Math.abs(b.halfHeight),Math.abs(d)<h&&Math.abs(e)<i&&(f=h-Math.abs(d),g=i-Math.abs(e),f>=g?(e>0?(c="top",a.y=a.y+g):(c="bottom",a.y=a.y-g),j&&(a.vy*=-1)):(d>0?(c="left",a.x=a.x+f):(c="right",a.x=a.x-f),j&&(a.vx*=-1))),c}hitTestRectangle(a,b,g=!1){a._bumpPropertiesAdded||this.addCollisionProperties(a),b._bumpPropertiesAdded||this.addCollisionProperties(b);let h,e,f,c,d;return g?(c=a.gx+Math.abs(a.halfWidth)-a.xAnchorOffset-(b.gx+Math.abs(b.halfWidth)-b.xAnchorOffset),d=a.gy+Math.abs(a.halfHeight)-a.yAnchorOffset-(b.gy+Math.abs(b.halfHeight)-b.yAnchorOffset)):(c=a.x+Math.abs(a.halfWidth)-a.xAnchorOffset-(b.x+Math.abs(b.halfWidth)-b.xAnchorOffset),d=a.y+Math.abs(a.halfHeight)-a.yAnchorOffset-(b.y+Math.abs(b.halfHeight)-b.yAnchorOffset)),e=Math.abs(a.halfWidth)+Math.abs(b.halfWidth),f=Math.abs(a.halfHeight)+Math.abs(b.halfHeight),Math.abs(c)<e&&Math.abs(d)<f}hitTestCircleRectangle(b,a,j=!1){a._bumpPropertiesAdded||this.addCollisionProperties(a),b._bumpPropertiesAdded||this.addCollisionProperties(b);let g,h,f,i,c,e;if(j?(f=b.gx,i=b.gy,c=a.gx,e=a.gy):(f=b.x,i=b.y,c=a.x,e=a.y),"topMiddle"==(g=i-b.yAnchorOffset<e-Math.abs(a.halfHeight)-a.yAnchorOffset?f-b.xAnchorOffset<c-1-Math.abs(a.halfWidth)-a.xAnchorOffset?"topLeft":f-b.xAnchorOffset>c+1+Math.abs(a.halfWidth)-a.xAnchorOffset?"topRight":"topMiddle":i-b.yAnchorOffset>e+Math.abs(a.halfHeight)-a.yAnchorOffset?f-b.xAnchorOffset<c-1-Math.abs(a.halfWidth)-a.xAnchorOffset?"bottomLeft":f-b.xAnchorOffset>c+1+Math.abs(a.halfWidth)-a.xAnchorOffset?"bottomRight":"bottomMiddle":f-b.xAnchorOffset<c-Math.abs(a.halfWidth)-a.xAnchorOffset?"leftMiddle":"rightMiddle")||"bottomMiddle"===g||"leftMiddle"===g||"rightMiddle"===g)h=this.hitTestRectangle(b,a,j);else{let d={};switch(g){case"topLeft":d.x=c-a.xAnchorOffset,d.y=e-a.yAnchorOffset;break;case"topRight":d.x=c+a.width-a.xAnchorOffset,d.y=e-a.yAnchorOffset;break;case"bottomLeft":d.x=c-a.xAnchorOffset,d.y=e+a.height-a.yAnchorOffset;break;case"bottomRight":d.x=c+a.width-a.xAnchorOffset,d.y=e+a.height-a.yAnchorOffset}h=this.hitTestCirclePoint(b,d,j)}return h?g:h}hitTestCirclePoint(b,a,c=!1){return b._bumpPropertiesAdded||this.addCollisionProperties(b),a.diameter=1,a.width=a.diameter,a.radius=.5,a.centerX=a.x,a.centerY=a.y,a.gx=a.x,a.gy=a.y,a.xAnchorOffset=0,a.yAnchorOffset=0,a._bumpPropertiesAdded=!0,this.hitTestCircle(b,a,c)}circleRectangleCollision(b,a,k=!1,j=!1){a._bumpPropertiesAdded||this.addCollisionProperties(a),b._bumpPropertiesAdded||this.addCollisionProperties(b);let g,h,f,i,c,e;if(j?(f=b.gx,i=b.gy,c=a.gx,e=a.gy):(f=b.x,i=b.y,c=a.x,e=a.y),"topMiddle"==(g=i-b.yAnchorOffset<e-Math.abs(a.halfHeight)-a.yAnchorOffset?f-b.xAnchorOffset<c-1-Math.abs(a.halfWidth)-a.xAnchorOffset?"topLeft":f-b.xAnchorOffset>c+1+Math.abs(a.halfWidth)-a.xAnchorOffset?"topRight":"topMiddle":i-b.yAnchorOffset>e+Math.abs(a.halfHeight)-a.yAnchorOffset?f-b.xAnchorOffset<c-1-Math.abs(a.halfWidth)-a.xAnchorOffset?"bottomLeft":f-b.xAnchorOffset>c+1+Math.abs(a.halfWidth)-a.xAnchorOffset?"bottomRight":"bottomMiddle":f-b.xAnchorOffset<c-Math.abs(a.halfWidth)-a.xAnchorOffset?"leftMiddle":"rightMiddle")||"bottomMiddle"===g||"leftMiddle"===g||"rightMiddle"===g)h=this.rectangleCollision(b,a,k,j);else{let d={};switch(g){case"topLeft":d.x=c-a.xAnchorOffset,d.y=e-a.yAnchorOffset;break;case"topRight":d.x=c+a.width-a.xAnchorOffset,d.y=e-a.yAnchorOffset;break;case"bottomLeft":d.x=c-a.xAnchorOffset,d.y=e+a.height-a.yAnchorOffset;break;case"bottomRight":d.x=c+a.width-a.xAnchorOffset,d.y=e+a.height-a.yAnchorOffset}h=this.circlePointCollision(b,d,k,j)}return h?g:h}circlePointCollision(b,a,c=!1,d=!1){return b._bumpPropertiesAdded||this.addCollisionProperties(b),a.diameter=1,a.width=a.diameter,a.radius=.5,a.centerX=a.x,a.centerY=a.y,a.gx=a.x,a.gy=a.y,a.xAnchorOffset=0,a.yAnchorOffset=0,a._bumpPropertiesAdded=!0,this.circleCollision(b,a,c,d)}bounceOffSurface(b,a){b._bumpPropertiesAdded||this.addCollisionProperties(b);let f,g,d={},c={},e={},h=b.mass||1;a.lx=a.y,a.ly=-a.x,a.magnitude=Math.sqrt(a.x*a.x+a.y*a.y),a.dx=a.x/a.magnitude,a.dy=a.y/a.magnitude,f=b.vx*a.dx+b.vy*a.dy,d.vx=f*a.dx,d.vy=f*a.dy,g=b.vx*(a.lx/a.magnitude)+b.vy*(a.ly/a.magnitude),c.vx=g*(a.lx/a.magnitude),c.vy=g*(a.ly/a.magnitude),c.vx*=-1,c.vy*=-1,e.x=d.vx+c.vx,e.y=d.vy+c.vy,b.vx=e.x/h,b.vy=e.y/h}contain(a,b,d=!1,e){a._bumpPropertiesAdded||this.addCollisionProperties(a),void 0===b.xAnchorOffset&&(b.xAnchorOffset=0),void 0===b.yAnchorOffset&&(b.yAnchorOffset=0),void 0===a.parent.gx&&(a.parent.gx=0),void 0===a.parent.gy&&(a.parent.gy=0);let c=new Set;return a.x-a.xAnchorOffset<b.x-a.parent.gx-b.xAnchorOffset&&(d&&(a.vx*=-1),a.mass&&(a.vx/=a.mass),a.x=b.x-a.parent.gx-b.xAnchorOffset+a.xAnchorOffset,c.add("left")),a.y-a.yAnchorOffset<b.y-a.parent.gy-b.yAnchorOffset&&(d&&(a.vy*=-1),a.mass&&(a.vy/=a.mass),a.y=b.y-a.parent.gy-b.yAnchorOffset+a.yAnchorOffset,c.add("top")),a.x-a.xAnchorOffset+a.width>b.width-b.xAnchorOffset&&(d&&(a.vx*=-1),a.mass&&(a.vx/=a.mass),a.x=b.width-a.width-b.xAnchorOffset+a.xAnchorOffset,c.add("right")),a.y-a.yAnchorOffset+a.height>b.height-b.yAnchorOffset&&(d&&(a.vy*=-1),a.mass&&(a.vy/=a.mass),a.y=b.height-a.height-b.yAnchorOffset+a.yAnchorOffset,c.add("bottom")),0===c.size&&(c=void 0),c&&e&&e(c),c}outsideBounds(b,c,d){let e=c.x,f=c.y,g=c.width,h=c.height,a=new Set;return b.x<e-b.width&&a.add("left"),b.y<f-b.height&&a.add("top"),b.x>g+b.width&&a.add("right"),b.y>h+b.height&&a.add("bottom"),0===a.size&&(a=void 0),a&&d&&d(a),a}_getCenter(a,b,c){return void 0===a.anchor?b:0!==a.anchor[c]?0:b/2}hit(a,b,g=!1,h=!1,i,d){let j=this.hitTestPoint.bind(this),k=this.hitTestRectangle.bind(this),l=this.hitTestCircle.bind(this),m=this.movingCircleCollision.bind(this),n=this.circleCollision.bind(this),o=this.hitTestCircleRectangle.bind(this),p=this.rectangleCollision.bind(this),q=this.circleRectangleCollision.bind(this),c,e=void 0!==a.parent,f=void 0!==b.parent;return e&&b instanceof Array||f&&a instanceof Array?function(){if(a instanceof Array){let[g,h]=[h,g]}for(let e=b.length-1;e>=0;e--){let f=b[e];(c=r(a,f))&&d&&d(c,f)}}():(c=r(a,b))&&d&&d(c),c;function r(a,b){let d=void 0!==a.parent,c=void 0!==b.parent;if(d&&c)return a.diameter&&b.diameter?s(a,b):a.diameter&&!b.diameter?u(a,b):t(a,b);if(c&& void 0!==a.x&& void 0!==a.y)return j(a,b);throw new Error(`I'm sorry, ${a} and ${b} cannot be use together in a collision test.'`)}function s(a,b){return g?a.vx+a.vy!==0&&b.vx+b.vy!==0?m(a,b,i):n(a,b,h,i):l(a,b)}function t(a,b){return g?p(a,b,h,i):k(a,b,i)}function u(a,b){return g?q(a,b,h,i):o(a,b,i)}}}